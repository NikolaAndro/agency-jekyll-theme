---
layout: kitchen_mealplan_generator
lang: eng
---

<div class="mealplan_generator_container" id="mealplan-page">
    <h1>Meal Plan Generator</h1>
    
    <h2 style="text-align: left; font-weight: bold; margin-bottom: 20px;">STEP 1 :  Calculate your BMR (Basic Metabolic Rate - he amount of energy expended per day at rest) :</h2>
   
    <div id="topmenu">
        <ul>
            <li id="menuon"><a onclick="return popMenu('standard',1);">US Units</a></li>
            <li><a onclick="return popMenu('metric',1);">Metric Units</a></li>
        </ul>
    </div>
    <div class="panel2" style="padding:10px;">
        <form action="calorie-calculator.html" name="calform">
            <table id="calinputtable" width="420">
                <tr>
                    <td width="50">Age</td>
                    <td width="370">
                        <div class="input-row">
                            <input type="number" name="cage" id="cage" value="25" class="inhalf" onkeyup="iptfieldCheck(this, 'r', 'pn');"  inputmode="numeric">
                            <span style="display: flex; align-items: center; height: 100%;">ages 15 - 80</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Gender</td>
                    <td>
                        <div class="input-row">
                            <label for="csex1" class="cbcontainer" style="margin-right: 10%;">
                                <input type="radio" name="csex" id="csex1" value="m" checked>
                                <span class="rbmark"></span> male
                            </label>
                            <label for="csex2" class="cbcontainer">
                                <input type="radio" name="csex" id="csex2" value="f">
                                <span class="rbmark"></span> female
                            </label>
                        </div>
                    </td>
                </tr>
            </table>
            <table width="420" id="standardheightweight" style="display: none;">
                <tr>
                    <td width="50">Height</td>
                    <td width="370">
                        <div class="input-container">
                            <div class="input-row" style="margin-right: 30px !important;">
                                <input type="number" name="cheightfeet" id="cheightfeet" value="5" class="inhalf inuifoot" onkeyup="iptfieldCheck(this, '', 'pzn');" inputmode="numeric">
                                <span class="inuifootspan">feet</span>
                            </div>
                            <div class="input-row">
                                <input type="number" name="cheightinch" id="cheightinch" value="10" class="inhalf inuiinch" onkeyup="iptfieldCheck(this, '', 'pzn');" inputmode="numeric">
                                <span class="inuiinchspan">inches</span>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Weight</td>
                    <td>
                        <div class="input-row">
                            <input type="number" name="cpound" id="cpound" value="165" class="infull inuipound" onkeyup="iptfieldCheck(this, 'r', 'pn');" inputmode="numeric">
                            <span class="inuipoundspan">pounds</span>
                        </div>
                    </td>
                </tr>
            </table>
            <table width="420" id="metricheightweight" style="display: block;">
                <tr>
                    <td width="50">Height</td>
                    <td width="370">
                        <div class="input-row">
                            <input type="number" name="cheightmeter" id="cheightmeter" value="180" class="infull inuick" onkeyup="iptfieldCheck(this, 'r', 'pn');" inputmode="numeric">
                            <span class="inuickspan">cm</span>
                        </div>
                    </td>
                </tr>
                <tr id="metricweight">
                    <td>Weight</td>
                    <td>
                        <div class="input-row">
                            <input type="number" name="ckg" id="ckg" value="65" class="infull inuick" onkeyup="iptfieldCheck(this, 'r', 'pn');" inputmode="numeric">
                            <span class="inuickspan">kg</span>
                        </div>
                    </td>
                </tr>
            </table>
            <table width="500">
                <tr>
                    <td width="50">Activity</td>
                    <td width="450">
                        <div class="custom-select-wrapper">
                            <select id="cactivity" name="cactivity" class="custom-select">
                                <option value="1">Basal Metabolic Rate (BMR)</option>
                                <option value="1.2">Sedentary: little or no exercise</option>
                                <option value="1.375">Light: exercise 1-3 times/week</option>
                                <option value="1.465" selected>Moderate: exercise 4-5 times/week</option>
                                <option value="1.55">Active: daily exercise or intense exercise 3-4 times/week</option>
                                <option value="1.725">Very Active: intense exercise 6-7 times/week</option>
                                <option value="1.9">Extra Active: very intense exercise daily, or physical job</option>
                            </select>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td width="50">&nbsp;</td>
                    <td width="450">
                        <div id="ccsettingtitle" style="margin: 10px 0;">
                            <b><a id="settingsToggle" onclick="return cshmoreoption(1);">+ Settings</a></b>
                        </div>
                        <div id="ccsettingcontent" style="display: none;">
                            <input type="hidden" name="cmop" id="cmoreoption" value="0">
                            <div style="padding-top:15px;"><b>BMR estimation formula:</b></div>
                            <div>
                                <div class="input-row" style="justify-content: left;"><label for="cformula1" class="cbcontainer" style="margin-bottom: 0px;"><input type="radio" name="cformula" id="cformula1" value="m" checked><span class="rbmark"></span> Mifflin St Jeor</label></div>
                                <div class="input-row" style="justify-content: left;"><label for="cformula3" class="cbcontainer" style="margin-bottom: 0px;"><input type="radio" name="cformula" id="cformula3" value="h"><span class="rbmark"></span> Revised Harris-Benedict</label></div>
                                <div class="input-row" style="justify-content: left;">
                                    <label for="cformula2" class="cbcontainer" style="margin-bottom: 0px;">
                                        <input type="radio" name="cformula" id="cformula2" value="k">
                                        <span class="rbmark"></span> Katch-McArdle
                                    </label> 
                                    &nbsp;&nbsp;&nbsp; 
                                    <a href="/body-fat-calculator.html">
                                        Body Fat:
                                    </a> 
                                    &nbsp;&nbsp;
                                    <input type="text" name="cfatpct" value="20" onkeyup="iptfieldCheck(this, '', 'pn');">                                        
                                    <span class="inuickspan">%</span> 
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td width="50">&nbsp;</td>
                    <td width="450">
                        <input name="printit" value="0" type="hidden">
                        <input type="hidden" name="ctype" id="ctype" value="metric">
                        <div style="display: flex; gap: 10px;">
                            <input id="bmr-calculate-btn" type="submit" name="x" value="Calculate" class="calculate-btn" onclick="calculateBMR(event);">
                            <input id="bmr-clean-btn" type="button" value="Clear" onclick="clearForm(document.calform);" style="background-color: #444;font-weight: bold;">
                        </div>
                        <div id="bmr-result"></div>
                    </td>
                </tr>
            </table>
        </form>
    </div>


    <h2 style="text-align: left; font-weight: bold; margin-bottom: 20px;">STEP 2 :  Enter your daily macronutrient goals:</h2>

    

    <form id="macro-form">
        <div id="calorieGoalDiv">
            <label for="calorie-goal" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" style="font-size: 14px; width: 200px; margin-right: 10px;">Calorie Goal (kcal):</label>
            <input type="number" id="calorie-goal" name="calorie-goal" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required style="font-size: 14px; width: 150px;" inputmode="numeric">
            <button type="button" id="get-suggestions" class="bg-blue-500 text-white rounded-lg p-2.5" style="font-size: 14px; margin-left: 20px; background-color: #f0c117; color: black; font-weight: bold;" onclick="getSuggestions()">Get Suggestions</button>
        </div>

        <div class="instructions-container">
            <table class="instructions-table">
                <tr>
                    <td class="instruction-title">Protein Instructions:</td>
                    <td class="instruction-detail">1 g of protein per lb of body mass</td>
                </tr>
                <tr>
                    <td class="instruction-title">Fat Instructions:</td>
                    <td class="instruction-detail">0.3 g of fat per lb of body weight at minimum</td>
                </tr>
                <tr>
                    <td class="instruction-title">Carbs Instructions:</td>
                    <td class="instruction-detail">The rest are carbs</td>
                </tr>
            </table>
        </div>
        <div class="macro-container">
            <div class="macro-goals">
                <div class="macro-goal">
                    <label for="protein" class="macro-label">Protein Goal (g):</label>
                    <input type="number" id="protein" name="protein" aria-describedby="protein-helper" class="macro-input" required inputmode="numeric">
                </div>
                <div class="macro-goal">
                    <label for="carbs" class="macro-label">Carbs Goal (g):</label>
                    <input type="number" id="carbs" name="carbs" aria-describedby="carbs-helper" class="macro-input" required inputmode="numeric">
                </div>
                <div class="macro-goal">
                    <label for="fat" class="macro-label">Fat Goal (g):</label>
                    <input type="number" id="fat" name="fat" aria-describedby="fat-helper" class="macro-input" required inputmode="numeric">
                </div>
            </div>
            <div class="macro-percentages">
                <div class="macro-percentage">
                    <span class="macro-percentage-label">Protein (%):</span>
                    <span id="protein-percentage" class="macro-value">0%</span>
                </div>
                <div class="macro-percentage">
                    <span class="macro-percentage-label">Carbs (%):</span>
                    <span id="carbs-percentage" class="macro-value">0%</span>
                </div>
                <div class="macro-percentage">
                    <span class="macro-percentage-label">Fat (%):</span>
                    <span id="fat-percentage" class="macro-value">0%</span>
                </div>
            </div>
        </div>
        <div class="note" >
            <p style="font-size: 1.8em"><b>NOTE:</b> If you manually adjust the macronutrient goals, you must click the <b>"Calculate Total Calories"</b> button to recalculate the total calories.</p>
        </div>

        <div style="margin-top: 20px;"></div>
            <button type="button" id="update-total-calories" class="bg-blue-500 text-white rounded-lg p-2.5" style="font-size: 1.95em; padding: 15px 100px 15px 100px; margin-bottom: 30px; background-color: #f0c117; color: black; font-weight: bold;">Calculate Total Calories</button>
        </div>
        <div class="total-calories-container">
            <!-- <label for="total-calories" class="total-calories-label">Total Calories Goal:</label> -->
            <span class="total-calories-label">Total Calories Goal:</span>
            <span id="total-calories" class="total-calories-value">0</span>
        </div>
    </form>

    <!-- Section that displays all meals for breakfast, lunchm dinner, and snacks -->
    <div id="meal-selections">
        <h2 style="text-align: left; font-weight: bold; margin-bottom: 20px;">STEP 3 : Select your meals:</h2>
        <div class="meal-category">
            <h3>Breakfast</h3>
            <div class="meal-options" id="breakfast-options">
                <!-- Breakfast meal options will be dynamically added here -->
            </div>
        </div>
        <div class="meal-category">
            <h3>Lunch</h3>
            <div class="meal-options" id="lunch-options">
            </div>
        </div>
        <div class="meal-category">
            <h3>Dinner</h3>
            <div class="meal-options" id="dinner-options">
            </div>
        </div>
        <div class="meal-category">
            <h3>Snacks</h3>
            <div class="meal-options" id="snacks-options">
            </div>
        </div>
    </div>

    <div id="meal-sections" style="display:none;"></div>

    

    <div id="mealModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="mealName"></h2>
            <p id="mealDescription"></p><br>
            <img id="mealDescriptionImage" src="" alt="Description Image" style="display: none; max-width: 100%; margin-top: 10px;">
        </div>
    </div>

    <div id="quantityModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Enter Quantity</h2>
            <div style="margin-bottom: 10px; display: flex; align-items: center; justify-content: center; max-width: 300px; margin: 0 auto;">
                <input type="number" id="quantityInput" min="0.1" step="0.1" value="1" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required inputmode="numeric" style="font-size: 14px; margin-right: 10px;">
                <button id="quantitySubmit" class="bg-blue-500 text-white rounded-lg p-2.5" style="font-size: 14px; width: 100px; background-color: #fed136; margin-left: 20px;">Add</button>
            </div>
        </div>
    </div>

    <h2 class="step-heading">STEP 4 : Generate your grocery list:</h2>
    <div class="days-input-container">
        <label for="days" class="days-label">Number of Days:</label>
        <input type="number" id="days" name="days" class="days-input" required inputmode="numeric">
        <button type="button" id="generate-grocery-list" class="generate-button" onclick="generateGroceryList()">
            <i class="fas fa-list"></i> Generate Grocery List
        </button>
    </div>
    <div id="grocery-list" class="grocery-list"></div>
    <div class="grocery-buttons-container">
        <button type="button" id="print-grocery-list" class="grocery-button" onclick="printGroceryList()">
            <i class="fas fa-print"></i> Print Grocery List
        </button>
        <button type="button" id="share-grocery-list" class="grocery-button" onclick="exportGroceryList()">
            <i class="fas fa-share-alt"></i> Share Grocery List
        </button>
        <button type="button" id="open-grocery-list" class="grocery-button" onclick="openGroceryList()">
            <i class="fas fa-external-link-alt"></i> Open Grocery List in New Tab
        </button>
    </div>

    <!-- <script src="{{ site.baseurl }}/kitchen/eng/js/mealplan_generator/step_1_bmr.js"></script>
    <script src="{{ site.baseurl }}/kitchen/eng/js/mealplan_generator/step_2_macros.js"></script>
    <script src="{{ site.baseurl }}/kitchen/eng/js/mealplan_generator/step_3_foodSelection.js"></script>
    <script src="{{ site.baseurl }}/kitchen/eng/js/mealplan_generator/step_4_groceries.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
</div>

<!-- BMR Calculator -->
<script>
    function calculateBMR(event) {
        console.log('calculateBMR function called');
        event.preventDefault(); // Prevent form submission

        const age = parseFloat(document.getElementById('cage').value);
        const gender = document.querySelector('input[name="csex"]:checked').value;
        const formula = document.querySelector('input[name="cformula"]:checked').value;
        const unitType = document.querySelector('#topmenu ul #menuon a').getAttribute('onclick').match(/'([^']+)'/)[1];
        const activityFactor = parseFloat(document.getElementById('cactivity').value);

        let weight, height, bodyFat;
        if (unitType === 'standard') {
            const weightPounds = parseFloat(document.getElementById('cpound').value);
            const heightFeet = parseFloat(document.getElementById('cheightfeet').value);
            const heightInches = parseFloat(document.getElementById('cheightinch').value);

            // Validation checks for standard units
            if (isNaN(weightPounds) || isNaN(heightFeet) || isNaN(heightInches)) {
                alert('Please enter valid values for weight, height (feet and inches).');
                return;
            }

            weight = weightPounds * 0.453592; // Convert pounds to kg
            height = (heightFeet * 12 + heightInches) * 2.54; // Convert feet and inches to cm
        } else {
            weight = parseFloat(document.getElementById('ckg').value);
            height = parseFloat(document.getElementById('cheightmeter').value);

            // Validation checks for metric units
            if (isNaN(weight) || isNaN(height)) {
                alert('Please enter valid values for weight and height.');
                return;
            }
        }

        // Validation check for age
        if (isNaN(age)) {
            alert('Please enter a valid age.');
            return;
        }

        if (formula === 'k') {
            bodyFat = parseFloat(document.querySelector('input[name="cfatpct"]').value) / 100;

            // Validation check for body fat percentage
            if (isNaN(bodyFat)) {
                alert('Please enter a valid body fat percentage.');
                return;
            }
        }

        let bmr;
        if (formula === 'm') {
            // Mifflin-St Jeor Equation
            if (gender === 'm') {
                bmr = 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                bmr = 10 * weight + 6.25 * height - 5 * age - 161;
            }
        } else if (formula === 'h') {
            // Revised Harris-Benedict Equation
            if (gender === 'm') {
                bmr = 13.397 * weight + 4.799 * height - 5.677 * age + 88.362;
            } else {
                bmr = 9.247 * weight + 3.098 * height - 4.330 * age + 447.593;
            }
        } else if (formula === 'k') {
            // Katch-McArdle Formula
            bmr = 370 + 21.6 * (1 - bodyFat) * weight;
        }

        // Multiply BMR by activity factor to get maintenance calories
        const maintenanceCalories = bmr * activityFactor;

        // Display the results
        document.getElementById('bmr-result').innerHTML = `
            Your BMR is ${bmr.toFixed(2)} calories/day.<br>
            Your maintenance is ${maintenanceCalories.toFixed(2)} calories/day.<br>
        `;
        console.log('BMR calculation completed');
    }

    function clearForm(form) {
        console.log('clearForm function called');
        form.reset();
        document.getElementById('bmr-result').textContent = '';

        // Clear specific input fields
        document.getElementById('cage').value = '';
        document.getElementById('cpound').value = '';
        document.getElementById('cheightfeet').value = '';
        document.getElementById('cheightinch').value = '';
        document.getElementById('ckg').value = '';
        document.getElementById('cheightmeter').value = '';
        console.log('Form cleared');
    }

    document.addEventListener("DOMContentLoaded", function() {
        console.log('DOMContentLoaded event fired');
        var menuItems = document.querySelectorAll("#topmenu ul li a");

        menuItems.forEach(function(item) {
            item.addEventListener("click", function(event) {
                console.log('Menu item clicked');
                event.preventDefault(); // Prevent default link behavior

                // Remove the 'menuon' id from the currently active item
                var activeItem = document.querySelector("#topmenu ul #menuon");
                if (activeItem) {
                    activeItem.removeAttribute("id");
                }

                // Set the 'menuon' id to the clicked item
                this.parentElement.setAttribute("id", "menuon");

                // Call the popMenu function with the appropriate parameters
                var unitType = this.getAttribute("onclick").match(/'([^']+)'/)[1];
                var unitValue = this.getAttribute("onclick").match(/,(\d+)\)/)[1];
                popMenu(unitType, unitValue);
            });
        });

        // Set the initial state
        popMenu('standard', 1);
        console.log('Initial state set');
    });

    function popMenu(unitType, unitValue) {
        console.log('popMenu function called with unitType:', unitType, 'and unitValue:', unitValue);
        var standardTable = document.getElementById('standardheightweight');
        var metricTable = document.getElementById('metricheightweight');

        if (unitType === 'standard') {
            standardTable.style.display = 'block';
            metricTable.style.display = 'none';
        } else if (unitType === 'metric') {
            standardTable.style.display = 'none';
            metricTable.style.display = 'block';
        }

        console.log('popMenu function completed');
        return false; // Prevent default link behavior
    }

    // settings toggle
    function cshmoreoption(toggle) {
        console.log('cshmoreoption function called with toggle:', toggle);
        var content = document.getElementById('ccsettingcontent');
        var moreOption = document.getElementById('cmoreoption');
        var settingsToggle = document.getElementById('settingsToggle');

        if (toggle) {
            if (content.style.display === 'none') {
                content.style.display = 'block';
                moreOption.value = '1';
                settingsToggle.textContent = '- Settings';
            } else {
                content.style.display = 'none';
                moreOption.value = '0';
                settingsToggle.textContent = '+ Settings';
            }
        }
        console.log('cshmoreoption function completed');
        return false; // Prevent default link behavior
    }
</script>

<!-- Calorie Calculator -->
<script>
    function getSuggestions() { 
        console.log('getSuggestions function called');
        const calorieGoal = parseFloat(document.getElementById('calorie-goal').value);
        const weightPounds = parseFloat(document.getElementById('cpound').value) || parseFloat(document.getElementById('ckg').value) * 2.20462;

        if (isNaN(calorieGoal) || isNaN(weightPounds)) {
            alert('Please enter valid values for calorie goal and weight.');
            return;
        }

        const proteinGoal = weightPounds; // 1 g of protein per lb of body mass
        const fatGoal = weightPounds * 0.3; // 0.3 g of fat per lb of body weight
        const proteinCalories = proteinGoal * 4;
        const fatCalories = fatGoal * 9;
        const carbsCalories = calorieGoal - (proteinCalories + fatCalories);
        const carbsGoal = carbsCalories / 4;

        // Display macro goals
        document.getElementById('protein').value = proteinGoal.toFixed(2);
        document.getElementById('fat').value = fatGoal.toFixed(2);
        document.getElementById('carbs').value = carbsGoal.toFixed(2);
        // document.getElementById('total-calories').textContent = calorieGoal.toFixed(2);

        updatePercentages(calorieGoal);
        console.log('getSuggestions function completed');
    }

    function updatePercentages(calorieGoal) {
        console.log('updatePercentages function called');
        const protein = parseFloat(document.getElementById('protein').value) || 0;
        const carbs = parseFloat(document.getElementById('carbs').value) || 0;
        const fat = parseFloat(document.getElementById('fat').value) || 0;

        const proteinPercentage = ((protein * 4) / calorieGoal) * 100;
        const carbsPercentage = ((carbs * 4) / calorieGoal) * 100;
        const fatPercentage = ((fat * 9) / calorieGoal) * 100;

        document.getElementById('protein-percentage').textContent = proteinPercentage.toFixed(2) + '%';
        document.getElementById('carbs-percentage').textContent = carbsPercentage.toFixed(2) + '%';
        document.getElementById('fat-percentage').textContent = fatPercentage.toFixed(2) + '%';
        console.log('updatePercentages function completed');
    }

    document.getElementById('protein').addEventListener('input', function() {
        console.log('Protein input event triggered');
        updatePercentages(parseFloat(document.getElementById('calorie-goal').value));
    });
    document.getElementById('carbs').addEventListener('input', function() {
        console.log('Carbs input event triggered');
        updatePercentages(parseFloat(document.getElementById('calorie-goal').value));
    });
    document.getElementById('fat').addEventListener('input', function() {
        console.log('Fat input event triggered');
        updatePercentages(parseFloat(document.getElementById('calorie-goal').value));
    });    
</script>

<!-- Food Selection -->

<script>
    document.addEventListener("DOMContentLoaded", function() {
    console.log('DOMContentLoaded event fired');
    fetch('../foods.yaml')
        .then(response => response.text())
        .then(data => {
            console.log('Fetched foods.yaml data');
            const foods = jsyaml.load(data).foods;
            displayFoods(foods);
        });

    let totalProtein = 0;
    let totalCarbs = 0;
    let totalFat = 0;
    let totalCalories = 0;
    let totalCaloriesGoal = 0;

    const proteinInput = document.getElementById('protein');
    const carbsInput = document.getElementById('carbs');
    const fatInput = document.getElementById('fat');
    const totalCaloriesLabel = document.getElementById('total-calories');
    const updateButton = document.getElementById('update-total-calories');

    function updateTotalCaloriesGoal() {
        console.log('Updating total calories goal');
        const protein = parseFloat(proteinInput.value) || 0;
        const carbs = parseFloat(carbsInput.value) || 0;
        const fat = parseFloat(fatInput.value) || 0;

        totalCaloriesGoal = (protein * 4) + (carbs * 4) + (fat * 9);
        totalCaloriesLabel.textContent = totalCaloriesGoal.toFixed(2);
        updateFoodOptions();
    }

    updateButton.addEventListener('click', updateTotalCaloriesGoal);

    function displayFoods(foods) {
        console.log('Displaying foods');
        for (const [meal, items] of Object.entries(foods)) {
            const mealOptions = document.getElementById(`${meal}-options`);
            if (!mealOptions) {
                console.error(`Element with ID ${meal}-options not found.`);
                continue;
            }
            items.forEach(item => {
                const foodDiv = document.createElement('div');
                foodDiv.className = 'food-option';
                foodDiv.dataset.ingredients = JSON.stringify(item.ingredients);
                foodDiv.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center;">
                        <img src="${item.image}" alt="${item.name}">
                    </div>
                    <button class="description-button" data-name="${item.name}" data-description="${item.description}" data-description-image="${item.description_image || ''}">View Description</button>
                    <p>${item.name}</p>
                    <div class="macros">
                        <p>Protein: ${item.protein} g</p>
                        <p>Carbs: ${item.carbs} g</p>
                        <p>Fat: ${item.fat} g</p>
                        <p class="calories">Calories: ${item.calories} kcal</p>
                    </div>
                `;
                mealOptions.appendChild(foodDiv);

                foodDiv.querySelector('.description-button').addEventListener('click', function() {
                    showModal(this.dataset.name, this.dataset.description, this.dataset.descriptionImage);
                });

                foodDiv.querySelector('img').addEventListener('click', function() {
                    if (foodDiv.querySelector('.exceeds-goal-banner')) {
                        return;
                    }
                    showQuantityModal(foodDiv, item);
                });
            });
        }
        updateFoodOptions();
    }

    function updateFoodOptions() {
        console.log('Updating food options');
        document.querySelectorAll('.food-option').forEach(foodDiv => {
            const itemCalories = parseFloat(foodDiv.querySelector('.calories').textContent.split(' ')[1]);
            const banner = foodDiv.querySelector('.exceeds-goal-banner');
            if (totalCalories + itemCalories > totalCaloriesGoal) {
                if (!banner) {
                    const newBanner = document.createElement('div');
                    newBanner.className = 'exceeds-goal-banner';
                    newBanner.textContent = 'Exceeds Your Goal';
                    foodDiv.appendChild(newBanner);
                }
            } else {
                if (banner) {
                    banner.remove();
                }
            }
        });
        updateSelectedFoods();
    }

    function updateSelectedFoods() {
        console.log('Updating selected foods');
        const selectedBreakfast = document.getElementById('selected-breakfast');
        const selectedLunch = document.getElementById('selected-lunch');
        const selectedDinner = document.getElementById('selected-dinner');
        const selectedSnacks = document.getElementById('selected-snacks');

        // Clear the tables only once
        selectedBreakfast.innerHTML = '<tr><th>Quantity</th><th>Food</th></tr>';
        selectedLunch.innerHTML = '<tr><th>Quantity</th><th>Food</th></tr>';
        selectedDinner.innerHTML = '<tr><th>Quantity</th><th>Food</th></tr>';
        selectedSnacks.innerHTML = '<tr><th>Quantity</th><th>Food</th></tr>';

        const selectedFoods = document.querySelectorAll('.food-option.selected');
        const fragmentBreakfast = document.createDocumentFragment();
        const fragmentLunch = document.createDocumentFragment();
        const fragmentDinner = document.createDocumentFragment();
        const fragmentSnacks = document.createDocumentFragment();

        selectedFoods.forEach(foodDiv => {
            const mealType = foodDiv.closest('.meal-category').querySelector('h3').textContent.toLowerCase();
            const foodName = foodDiv.querySelector('p').textContent;
            const quantity = foodDiv.querySelector('.quantity-label').textContent.split(': ')[1];

            const foodItem = document.createElement('tr');
            foodItem.innerHTML = `<td>${quantity}</td><td>${foodName}</td>`;

            if (mealType === 'breakfast') {
                fragmentBreakfast.appendChild(foodItem);
            } else if (mealType === 'lunch') {
                fragmentLunch.appendChild(foodItem);
            } else if (mealType === 'dinner') {
                fragmentDinner.appendChild(foodItem);
            } else if (mealType === 'snacks') {
                fragmentSnacks.appendChild(foodItem);
            }
        });

        selectedBreakfast.appendChild(fragmentBreakfast);
        selectedLunch.appendChild(fragmentLunch);
        selectedDinner.appendChild(fragmentDinner);
        selectedSnacks.appendChild(fragmentSnacks);
    }

    function showModal(name, description, descriptionImage) {
        console.log('Showing modal for', name);
        const modal = document.getElementById('mealModal');
        document.getElementById('mealName').textContent = name;
        document.getElementById('mealDescription').textContent = description;

        const descriptionImageElement = document.getElementById('mealDescriptionImage');
        if (descriptionImage) {
            descriptionImageElement.src = descriptionImage;
            descriptionImageElement.style.display = 'block';
        } else {
            descriptionImageElement.style.display = 'none';
        }

        modal.style.display = 'block';
    }

    function showQuantityModal(foodDiv, item) {
        console.log('Showing quantity modal for', item.name);
        const modal = document.getElementById('quantityModal');
        modal.style.display = 'block';

        const quantityInput = document.getElementById('quantityInput');
        quantityInput.value = '';
        quantityInput.focus();

        function addFood() {
            console.log('Adding food', item.name);
            const newQuantity = parseFloat(quantityInput.value);
            const oldQuantity = parseFloat(foodDiv.dataset.quantity) || 0;

            if (isNaN(newQuantity) || newQuantity <= 0.1) {
                alert('Please enter a valid quantity.');
                return;
            }

            if (newQuantity === oldQuantity) {
                modal.style.display = 'none';
                return;
            }

            if (totalCalories + (item.calories * newQuantity) - (item.calories * oldQuantity) > totalCaloriesGoal) {
                alert('Adding this item exceeds your total calories goal.');
                return;
            }

            console.log(`Item: ${item.name}, Old Quantity: ${oldQuantity}, New Quantity: ${newQuantity}`);

            foodDiv.classList.add('selected');
            foodDiv.querySelector('img').classList.add('selected');
            let quantityLabel = foodDiv.querySelector('.quantity-label');
            if (!quantityLabel) {
                quantityLabel = document.createElement('div');
                quantityLabel.className = 'quantity-label';
                foodDiv.insertBefore(quantityLabel, foodDiv.firstChild);
            }
            quantityLabel.textContent = `Quantity: ${newQuantity}`;

            let deselectButton = foodDiv.querySelector('.deselect-button');
            if (!deselectButton) {
                deselectButton = document.createElement('button');
                deselectButton.className = 'deselect-button';
                deselectButton.textContent = 'Deselect';
                foodDiv.insertBefore(deselectButton, quantityLabel.nextSibling);
            } else {
                deselectButton.replaceWith(deselectButton.cloneNode(true));
                deselectButton = foodDiv.querySelector('.deselect-button');
            }

            deselectButton.addEventListener('click', function() {
                console.log('Deselecting', item.name);
                foodDiv.classList.remove('selected');
                foodDiv.querySelector('img').classList.remove('selected');
                if (quantityLabel) {
                    quantityLabel.remove();
                }
                if (deselectButton) {
                    deselectButton.remove();
                }
                updateAggregatedValues(-item.protein * foodDiv.dataset.quantity, -item.carbs * foodDiv.dataset.quantity, -item.fat * foodDiv.dataset.quantity, -item.calories * foodDiv.dataset.quantity);
                foodDiv.dataset.quantity = 0;
            });

            updateAggregatedValues(
                item.protein * newQuantity - item.protein * oldQuantity,
                item.carbs * newQuantity - item.carbs * oldQuantity,
                item.fat * newQuantity - item.fat * oldQuantity,
                item.calories * newQuantity - item.calories * oldQuantity
            );

            foodDiv.dataset.quantity = newQuantity;
            modal.style.display = 'none';
        }

        document.getElementById('quantitySubmit').onclick = addFood;

        quantityInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                addFood();
            }
        });
    }

    function updateAggregatedValues(protein, carbs, fat, calories) {
        console.log('Updating aggregated values');
        totalProtein += protein;
        totalCarbs += carbs;
        totalFat += fat;
        totalCalories += calories;

        document.getElementById('total-protein').textContent = totalProtein.toFixed(2);
        document.getElementById('total-carbs').textContent = totalCarbs.toFixed(2);
        document.getElementById('total-fat').textContent = totalFat.toFixed(2);
        document.getElementById('total-aggregated-calories').textContent = totalCalories.toFixed(2);

        updateFoodOptions();
    }

    document.querySelectorAll('.modal .close').forEach(closeBtn => {
        closeBtn.addEventListener('click', function() {
            console.log('Closing modal');
            this.closest('.modal').style.display = 'none';
        });
    });

    window.addEventListener('click', function(event) {
        const quantityModal = document.getElementById('quantityModal');
        const mealModal = document.getElementById('mealModal');
        if (event.target === quantityModal || event.target === mealModal) {
            console.log('Closing modal by clicking outside');
            event.target.style.display = 'none';
        }
    });

    window.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            console.log('Closing modal by pressing Escape');
            const quantityModal = document.getElementById('quantityModal');
            const mealModal = document.getElementById('mealModal');
            quantityModal.style.display = 'none';
            mealModal.style.display = 'none';
        }
    });
});
</script>

<!-- Groceries -->
 <script>
    function generateGroceryList() {
        console.log('generateGroceryList function called');
        const days = parseFloat(document.getElementById('days').value);
        if (isNaN(days) || days <= 0) {
            alert('Please enter a valid number of days.');
            return;
        }

        const groceryList = {};
        document.querySelectorAll('.food-option.selected').forEach(foodDiv => {
            const quantity = parseFloat(foodDiv.dataset.quantity) || 0;
            const totalQuantity = quantity * days;

            const ingredients = foodDiv.dataset.ingredients ? JSON.parse(foodDiv.dataset.ingredients) : [];
            ingredients.forEach(ingredient => {
                const ingredientName = ingredient.name;
                const ingredientQuantity = ingredient.amount * totalQuantity;
                const ingredientUnit = ingredient.unit;

                if (groceryList[ingredientName]) {
                    groceryList[ingredientName].quantity += ingredientQuantity;
                } else {
                    groceryList[ingredientName] = { quantity: ingredientQuantity, unit: ingredientUnit };
                }
            });
        });

        const groceryListDiv = document.getElementById('grocery-list');
        groceryListDiv.innerHTML = '<h3 style="margin-bottom:20px">Grocery List:</h3>';
        const table = document.createElement('table');
        table.style.width = '100%';
        table.style.borderCollapse = 'collapse';
        table.style.minWidth = '100%'; // Ensure table is full width on phone size
        const thead = document.createElement('thead');
        thead.innerHTML = '<tr><th>Ingredient</th><th>Quantity</th><th>Unit</th></tr>';
        table.appendChild(thead);
        const tbody = document.createElement('tbody');
        for (const [ingredient, { quantity, unit }] of Object.entries(groceryList)) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${ingredient}</td><td>${quantity.toFixed(2)}</td><td>${unit}</td>`;
            tbody.appendChild(tr);
        }
        table.appendChild(tbody);
        groceryListDiv.appendChild(table);
        console.log('generateGroceryList function completed');
    }

    function printGroceryList() {
        console.log('printGroceryList function called');
        const groceryListDiv = document.getElementById('grocery-list');
        const printWindow = window.open('', '', 'height=600,width=800');
        printWindow.document.write('<html><head><title>Grocery List</title>');
        printWindow.document.write('</head><body >');
        printWindow.document.write(groceryListDiv.innerHTML);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.print();
        console.log('printGroceryList function completed');
    }

    function exportGroceryList() {
        console.log('exportGroceryList function called');
        const groceryListDiv = document.getElementById('grocery-list');

        // Extract and format text from the grocery list table
        const rows = groceryListDiv.querySelectorAll('table tbody tr');
        const formattedList = Array.from(rows)
            .map(row => {
                const cells = row.querySelectorAll('td');
                return `${cells[0].innerText}: ${cells[1].innerText} ${cells[2].innerText}`;
            })
            .join('\n'); // Newline-separated list

        const exportButton = document.getElementById('export-grocery-list'); // Get the button element

        if (navigator.share) {
            // Use the Web Share API for mobile devices
            navigator.share({
                title: 'Grocery List',
                text: formattedList,
            })
            .then(() => console.log('Grocery list shared successfully!'))
            .catch(error => console.error('Error sharing the grocery list:', error));
        } else {
            // Fallback for unsupported browsers or desktops
            const existingOptions = document.getElementById('share-options');
            if (existingOptions) existingOptions.remove(); // Remove existing options if present

            const encodedText = encodeURIComponent(formattedList);

            // Get the position of the button
            const rect = exportButton.getBoundingClientRect();
            const top = rect.bottom + window.scrollY; // Bottom of the button
            const left = rect.left + window.scrollX; // Left of the button

            const options = `
                <div id="share-options" style="position: absolute; top: ${top}px; left: ${left}px; background: white; border: 1px solid #ccc; padding: 10px; z-index: 1000; box-shadow: 0px 4px 6px rgba(0,0,0,0.1);">
                    <button onclick="shareViaApp('signal', '${encodeURIComponent(formattedList)}')">Share via Signal</button><br>
                    <button onclick="shareViaApp('whatsapp', '${encodeURIComponent(formattedList)}')">Share via WhatsApp</button><br>
                    <button onclick="shareViaApp('email', '${encodeURIComponent(formattedList)}')">Share via Email</button><br>
                    <button onclick="document.getElementById('share-options').remove()">Cancel</button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', options);
        }
        console.log('exportGroceryList function completed');
    }

    function shareViaApp(app, encodedText) {
        console.log('shareViaApp function called with app:', app);
        let url;
        switch (app) {
            case 'signal':
                url = `sgnl://send?text=${encodedText}`;
                break;
            case 'whatsapp':
                url = `https://web.whatsapp.com/send?text=${encodedText}`;
                break;
            case 'email':
                url = `mailto:?subject=Grocery%20List&body=${encodedText}`;
                break;
            default:
                console.error('Unsupported app');
                return;
        }
        window.open(url, '_blank');
        const shareOptions = document.getElementById('share-options');
        if (shareOptions) shareOptions.remove(); // Clean up options menu
        console.log('shareViaApp function completed');
    }

    function openGroceryList() {
        console.log('openGroceryList function called');
        const groceryListDiv = document.getElementById('grocery-list');
        const rows = groceryListDiv.querySelectorAll('table tbody tr');
        const tableContent = Array.from(rows)
            .map(row => {
                const cells = row.querySelectorAll('td');
                return `<tr>
                            <td>${cells[1].innerText}</td>
                            <td>${cells[2].innerText}</td>
                            <td>${cells[0].innerText}</td>
                            <td><input type="checkbox" style="transform: scale(2);"></td>
                        </tr>`;
            })
            .join('');

        const newTab = window.open('', '_blank');
        newTab.document.write(`
            <html>
            <head>
                <title style="margin-bottom: 20px">Grocery List</title>
                <style>
                    table {
                        min-width: 100%;
                        border-collapse: collapse;
                    }
                    th, td {
                        border: 1px solid #ddd;
                        padding: 8px;
                        text-align: center;
                        font-size: 1.6em;
                    }
                    th {
                        background-color: #f2f2f2;
                        font-weight: bold;
                        font-size: 1.8em;
                    }
                    /* Media query for smaller screens */
                    @media (max-width: 768px) {
                        table {
                            min-width: 100%; /* Ensure table is full width */
                        }
                        th, td {
                            font-size: 1.5em; /* Increase font size for table cells */
                            padding: 10px; /* Increase padding for better touch experience */
                        }
                    }
                </style>
            </head>
            <body>
                <h3 style="margin-bottom:20px; tex-align: center; font-size: 3.5em">Grocery List</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Quantity</th>
                            <th>Unit</th>
                            <th>Food Name</th>
                            <th>Check</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableContent}
                    </tbody>
                </table>
            </body>
            </html>
        `);
        newTab.document.close();
        console.log('openGroceryList function completed');
    }
 </script>