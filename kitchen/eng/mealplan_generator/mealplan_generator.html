---
layout: kitchen_mealplan_generator
lang: eng
---

<div class="mealplan_generator_container" id="mealplan-page">
    <h1>Meal Plan Generator</h1>
    
    <h2 style="text-align: left; font-weight: bold; margin-bottom: 20px;">STEP 1 :  Enter your daily macronutrient goals:</h2>

    <form id="macro-form">
        <div style="margin-bottom: 40px; display: flex; align-items: flex-start; justify-content: center; min-width: 750px;">
            <div style="display: flex; align-items: center; margin-right: 20px;">
                <label for="protein" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" style="font-size: 14px; width: 120px; margin-right: 10px;">Protein Goal (g):</label>
                <input type="number" id="protein" name="protein" aria-describedby="protein-helper" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required style="font-size: 14px; width: 100px;">
            </div>
            <div style="display: flex; align-items: center; margin-right: 20px;">
                <label for="carbs" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" style="font-size: 14px; width: 120px; margin-right: 10px;">Carbs Goal (g):</label>
                <input type="number" id="carbs" name="carbs" aria-describedby="carbs-helper" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required style="font-size: 14px; width: 100px;">
            </div>
            <div style="display: flex; align-items: center;">
                <label for="fat" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" style="font-size: 14px; width: 120px; margin-right: 10px;">Fat Goal (g):</label>
                <input type="number" id="fat" name="fat" aria-describedby="fat-helper" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required style="font-size: 14px; width: 100px;">
            </div>
        </div>
        <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
            <label for="calories" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" style="font-size: 18px; font-weight: bold; margin-right: 20px;">Total Calories Goal:</label>
            <span id="total-calories" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" style="font-size: 18px; font-weight: bold; margin-left: 10px;">0</span>
        </div>
    </form>

    <!-- Section that displays all meals for breakfast, lunchm dinner, and snacks -->
    <div id="meal-selections">
        <h2 style="text-align: left; font-weight: bold; margin-bottom: 20px;">STEP 2 : Select your meals:</h2>
        <div class="meal-category">
            <h3>Breakfast</h3>
            <div class="meal-options" id="breakfast-options">
                <!-- Breakfast meal options will be dynamically added here -->
            </div>
        </div>
        <div class="meal-category">
            <h3>Lunch</h3>
            <div class="meal-options" id="lunch-options">
            </div>
        </div>
        <div class="meal-category">
            <h3>Dinner</h3>
            <div class="meal-options" id="dinner-options">
            </div>
        </div>
        <div class="meal-category">
            <h3>Snacks</h3>
            <div class="meal-options" id="snacks-options">
            </div>
        </div>
    </div>

    <div id="meal-sections" style="display:none;"></div>

    

    <div id="mealModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="mealName"></h2>
            <p id="mealDescription"></p>
        </div>
    </div>

    <div id="quantityModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Enter Quantity</h2>
            <div style="margin-bottom: 10px; display: flex; align-items: center; justify-content: center; max-width: 300px; margin: 0 auto;">
                <input type="number" id="quantityInput" min="0.1" step="0.1" value="1" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required style="font-size: 14px; margin-right: 10px;">
                <button id="quantitySubmit" class="bg-blue-500 text-white rounded-lg p-2.5" style="font-size: 14px; width: 100px; background-color: #fed136; margin-left: 20px;">Add</button>
            </div>
        </div>
    </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        fetch('../foods.yaml')
            .then(response => response.text())
            .then(data => {
                const foods = jsyaml.load(data).foods;
                displayFoods(foods);
            });

        let totalProtein = 0;
        let totalCarbs = 0;
        let totalFat = 0;
        let totalCalories = 0;
        let totalCaloriesGoal = 0;

        const proteinInput = document.getElementById('protein');
        const carbsInput = document.getElementById('carbs');
        const fatInput = document.getElementById('fat');
        const totalCaloriesLabel = document.getElementById('total-calories');

        function updateTotalCaloriesGoal() {
            const protein = parseFloat(proteinInput.value) || 0;
            const carbs = parseFloat(carbsInput.value) || 0;
            const fat = parseFloat(fatInput.value) || 0;

            totalCaloriesGoal = (protein * 4) + (carbs * 4) + (fat * 9);
            totalCaloriesLabel.textContent = totalCaloriesGoal.toFixed(2);
            updateFoodOptions();
        }

        proteinInput.addEventListener('input', updateTotalCaloriesGoal);
        carbsInput.addEventListener('input', updateTotalCaloriesGoal);
        fatInput.addEventListener('input', updateTotalCaloriesGoal);

        function displayFoods(foods) {
            for (const [meal, items] of Object.entries(foods)) {
                const mealOptions = document.getElementById(`${meal}-options`);
                if (!mealOptions) {
                    console.error(`Element with ID ${meal}-options not found.`);
                    continue;
                }
                items.forEach(item => {
                    const foodDiv = document.createElement('div');
                    foodDiv.className = 'food-option';
                    foodDiv.innerHTML = `
                        <img src="${item.image}" alt="${item.name}">
                        <button class="description-button" data-name="${item.name}" data-description="${item.description}">View Description</button>
                        <p>${item.name}</p>
                        <div class="macros">
                            <p>Protein: ${item.protein} g</p>
                            <p>Carbs: ${item.carbs} g</p>
                            <p>Fat: ${item.fat} g</p>
                            <p class="calories">Calories: ${item.calories} kcal</p>
                        </div>
                    `;
                    mealOptions.appendChild(foodDiv);

                    // Add click event listener to the button
                    foodDiv.querySelector('.description-button').addEventListener('click', function() {
                        showModal(this.dataset.name, this.dataset.description);
                    });

                    // Add click event listener to the image
                    foodDiv.querySelector('img').addEventListener('click', function() {
                        if (foodDiv.querySelector('.exceeds-goal-banner')) {
                            return; // Prevent selection if the banner is present
                        }
                        showQuantityModal(foodDiv, item);
                    });
                });
            }
            updateFoodOptions();
        }

        function updateFoodOptions() {
            document.querySelectorAll('.food-option').forEach(foodDiv => {
                const itemCalories = parseFloat(foodDiv.querySelector('.calories').textContent.split(' ')[1]);
                const banner = foodDiv.querySelector('.exceeds-goal-banner');
                if (totalCalories + itemCalories > totalCaloriesGoal) {
                    if (!banner) {
                        const newBanner = document.createElement('div');
                        newBanner.className = 'exceeds-goal-banner';
                        newBanner.textContent = 'Exceeds Your Goal';
                        foodDiv.appendChild(newBanner);
                    }
                } else {
                    if (banner) {
                        banner.remove();
                    }
                }
            });
        }

        function showModal(name, description) {
            const modal = document.getElementById('mealModal');
            document.getElementById('mealName').textContent = name;
            document.getElementById('mealDescription').textContent = description;
            modal.style.display = 'block';
        }

        function showQuantityModal(foodDiv, item) {
            const modal = document.getElementById('quantityModal');
            modal.style.display = 'block';

            const quantityInput = document.getElementById('quantityInput');
            quantityInput.value = '';
            quantityInput.focus(); // Set focus to the input field

            function addFood() {
                const newQuantity = parseFloat(quantityInput.value);
                const oldQuantity = parseFloat(foodDiv.dataset.quantity) || 0;

                if (isNaN(newQuantity) || newQuantity <= 0.1) {
                    alert('Please enter a valid quantity.');
                    return;
                }

                if (newQuantity === oldQuantity) {
                    modal.style.display = 'none';
                    return; // No change in quantity, no need to update
                }

                if (totalCalories + (item.calories * newQuantity) - (item.calories * oldQuantity) > totalCaloriesGoal) {
                    alert('Adding this item exceeds your total calories goal.');
                    return;
                }

                console.log(`Item: ${item.name}, Old Quantity: ${oldQuantity}, New Quantity: ${newQuantity}`);

                foodDiv.classList.add('selected');
                foodDiv.querySelector('img').classList.add('selected');
                let quantityLabel = foodDiv.querySelector('.quantity-label');
                if (!quantityLabel) {
                    quantityLabel = document.createElement('div');
                    quantityLabel.className = 'quantity-label';
                    foodDiv.insertBefore(quantityLabel, foodDiv.firstChild);
                }
                quantityLabel.textContent = `Quantity: ${newQuantity}`;

                // Create and insert the deselect button
                let deselectButton = foodDiv.querySelector('.deselect-button');
                if (!deselectButton) {
                    deselectButton = document.createElement('button');
                    deselectButton.className = 'deselect-button';
                    deselectButton.textContent = 'Deselect';
                    foodDiv.insertBefore(deselectButton, quantityLabel.nextSibling);
                } else {
                    // Remove existing event listener to avoid multiple triggers
                    deselectButton.replaceWith(deselectButton.cloneNode(true));
                    deselectButton = foodDiv.querySelector('.deselect-button');
                }

                // Add click event listener to the deselect button
                deselectButton.addEventListener('click', function() {
                    foodDiv.classList.remove('selected');
                    foodDiv.querySelector('img').classList.remove('selected');
                    if (quantityLabel) {
                        quantityLabel.remove();
                    }
                    if (deselectButton) {
                        deselectButton.remove();
                    }
                    console.log(`Deselecting - Item: ${item.name}, Old Quantity: ${foodDiv.dataset.quantity}, New Quantity: 0`);
                    updateAggregatedValues(-item.protein * foodDiv.dataset.quantity, -item.carbs * foodDiv.dataset.quantity, -item.fat * foodDiv.dataset.quantity, -item.calories * foodDiv.dataset.quantity);
                    foodDiv.dataset.quantity = 0; // Reset the quantity to zero
                });

                updateAggregatedValues(
                    item.protein * newQuantity - item.protein * oldQuantity,
                    item.carbs * newQuantity - item.carbs * oldQuantity,
                    item.fat * newQuantity - item.fat * oldQuantity,
                    item.calories * newQuantity - item.calories * oldQuantity
                );

                // Update the stored quantity
                foodDiv.dataset.quantity = newQuantity;

                modal.style.display = 'none';
            }

            // Handle quantity submission
            document.getElementById('quantitySubmit').onclick = addFood;

            // Add listener for "Return/Enter" key
            quantityInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    addFood();
                }
            });
        }

        function updateAggregatedValues(protein, carbs, fat, calories) {
            totalProtein += protein;
            totalCarbs += carbs;
            totalFat += fat;
            totalCalories += calories;

            document.getElementById('total-protein').textContent = totalProtein.toFixed(2);
            document.getElementById('total-carbs').textContent = totalCarbs.toFixed(2);
            document.getElementById('total-fat').textContent = totalFat.toFixed(2);
            document.getElementById('total-aggregated-calories').textContent = totalCalories.toFixed(2);

            updateFoodOptions();
        }

        // Close the modal
        document.querySelectorAll('.modal .close').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                this.closest('.modal').style.display = 'none';
            });
        });

        // Close the modal when clicking outside of it
        window.addEventListener('click', function(event) {
            const quantityModal = document.getElementById('quantityModal');
            const mealModal = document.getElementById('mealModal');
            if (event.target === quantityModal || event.target === mealModal) {
                event.target.style.display = 'none';
            }
        });

        // Close the modal when pressing the Escape key
        window.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const quantityModal = document.getElementById('quantityModal');
                const mealModal = document.getElementById('mealModal');
                quantityModal.style.display = 'none';
                mealModal.style.display = 'none';
            }
        });
    });
</script>